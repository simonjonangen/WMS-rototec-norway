{% extends 'layout.html' %}
{% block title %}Usage Logs{% endblock %}

{% block content %}
<style>
  .pagination .page-item.active .page-link {
    background-color: #4CAF50; /* Your chosen green */
    color: #fff;
    font-weight: bold;
    border-color: #4CAF50;
  }

  .pagination .page-link {
    color: #fff;
    background-color: #343a40;
    border: 1px solid #6c757d;
  }

  .pagination .page-link:hover {
    background-color: #4CAF50;
    color: #fff;
  }
</style>

<section id="hero" class="hero section dark-background">
  <img src="{{ url_for('static', filename='assets/img/hero-bg.jpg') }}" alt="" data-aos="fade-in">

  <div class="container" data-aos="fade-up" data-aos-delay="100">

    <!-- Section title -->
    <div class="container section-title text-center" data-aos="fade-up">
      <h2>Usage Logs</h2>
      <p>Track all actions performed by users on inventory</p>
    </div>

    <!-- Filter form -->
    <form method="GET" action="{{ url_for('logs.logs') }}" class="row g-3 mb-4">
      <div class="col-md-4">
        <input type="text" name="user" class="form-control" placeholder="Filter on User">
      </div>
      <div class="col-md-4">
        <input type="text" name="item" class="form-control" placeholder="Filter on Article">
      </div>
      <div class="col-md-4 d-flex">
        <button class="btn btn-outline-light w-100">Filter</button>
      </div>
    </form>

    <!-- Logs table -->
    <div class="table-responsive">
      <table id="logsTable" class="table table-hover table-striped align-middle text-center mb-0" style="border-radius: .5rem; overflow: hidden;">
        <thead class="table-dark text-white">
          <tr>
            <th>Date</th>
            <th>User</th>
            <th>Article Number</th>
            <th>Article</th>
            <th>Count</th>
            <th>Type</th>
          </tr>
        </thead>
        <tbody>
          {% for log in logs %}
          <tr>
            <td>{{ log.formatted_timestamp }}</td>
            <td style="font-size: 1.1rem; font-weight: 500;">{{ log.user_name }}</td>
            <td>{{ log.article_number }}</td>
            <td>{{ log.product_name }}</td>
            <td>{{ log.quantity }}</td>
            <td>{{ log.action }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Pagination controls -->
    <nav class="mt-4">
      <ul class="pagination justify-content-center" id="paginationControls"></ul>
    </nav>


  </div>
</section>

<!-- Pagination Script -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const rows = document.querySelectorAll("#logsTable tbody tr");
    const rowsPerPage = 15;
    const totalPages = Math.ceil(rows.length / rowsPerPage);
    const pagination = document.getElementById("paginationControls");

    let currentPage = 1;

    function showPage(page) {
      currentPage = page;
      rows.forEach((row, index) => {
        row.style.display = (index >= (page - 1) * rowsPerPage && index < page * rowsPerPage) ? "" : "none";
      });

      renderPagination();
    }

    function renderPagination() {
      pagination.innerHTML = "";

      for (let i = 1; i <= totalPages; i++) {
        const li = document.createElement("li");
        li.className = `page-item ${i === currentPage ? "active" : ""}`;
        li.innerHTML = `<button class="page-link">${i}</button>`;
        li.addEventListener("click", () => showPage(i));
        pagination.appendChild(li);
      }
    }

    if (rows.length > 0) {
      showPage(1);
    }
  });
</script>
{% endblock %}
