{% extends 'layout.html' %}

{% block title %}Report Issue{% endblock %}

{% block content %}

<style>
  .hero {
    min-height: auto !important;
    padding-top: 220px !important;
    padding-bottom: 20px !important;
  }

  .reduced-padding {
  padding-top: 10px !important;
}


  .hero .container {
    padding-top: 0 !important;
    padding-bottom: 0 !important;
  }

  .section-title {
    padding-bottom: 20px !important;
    margin-bottom: 10px !important;
  }

  #manualSearch {
    margin-bottom: 0.5rem;
  }

  #buttons-section {
    padding-top: 120px !important;
    padding-bottom: 20px !important;
    min-height: 500px;
    position: relative;
  }

  #buttons-section .hero-bg {
    position: absolute;
    inset: 0;
    background-image: url('/static/assets/img/hero-bg.jpg');
    background-size: cover;
    background-position: center;
    opacity: 0.3;
    z-index: 0;
    pointer-events: none;
  }

  #buttons-section .container {
    position: relative;
    z-index: 1;
    text-align: center;
  }

  .table-container {
    background: white;
    padding: 2rem;
    border-radius: 1rem;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
  }

  #table-section {
    position: relative;
    background-image: url('/static/assets/img/section-2-bg.png');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }
</style>

<style>
  html {
    scroll-behavior: smooth;
  }

  #reader {
    scroll-margin-top: 100px; /* Adjust this value based on your header height */
  }
</style>

<!-- Section 1: Hero/Search -->
<section id="hero" class="hero section dark-background">
  <div class="hero-bg" data-aos="fade-in"></div>
  <div class="container py-4" data-aos="fade-up">
    <div class="container section-title text-center" data-aos="fade-up">
      <h2>Report Issue</h2>
      <p>Scan or search to report an issue with equipment</p>
    </div>

    <div id="errorBox" class="alert alert-danger d-none" role="alert"></div>
    <div id="successBox" class="alert alert-success d-none" role="alert"></div>

    <div class="row justify-content-center mt-4">
      <div class="col-xl-4 col-md-4" data-aos="fade-up" data-aos-delay="300">
        <!-- Clickable container for QR Scanner -->
        <div class="icon-box text-center py-3 text-white" style="cursor: pointer;" onclick="startScanner()">
          <i class="bi bi-qr-code-scan" style="font-size: 1.5rem;"></i>
          <h3 class="mt-2" style="font-size: 1rem;">
            Start QR Scan
          </h3>
        </div>
      </div>
    </div>

    <!-- Stop Scanner Button (initially hidden) -->
    <div class="row justify-content-center mt-4">
      <div class="col-xl-4 col-md-4" data-aos="fade-up" data-aos-delay="300">
        <div id="stopBtn" class="icon-box text-center py-3 text-white d-none" style="cursor: pointer;" onclick="stopScanner()">
          <i class="bi bi-x-circle" style="font-size: 1.5rem;"></i>
          <h3 class="mt-2" style="font-size: 1rem;">
            Close Camera
          </h3>
        </div>
      </div>
    </div>

    <div class="d-flex justify-content-center mb-3">
      <div id="reader" style="width: 300px; margin-top: 1rem;" class="d-none"></div>
    </div>

    <div class="row justify-content-center g-2 mb-3">
      <div class="col-md-6 col-lg-4">
        <input type="text" id="manualSearch" class="form-control text-center" placeholder="Search by Article" oninput="fetchSuggestions()">
        <div id="suggestionCards" class="row g-2 mt-2"></div>
        <div class="text-center mt-2">
          <button id="loadMoreBtn" class="btn btn-outline-secondary d-none" onclick="toggleCardLimit()">Show more</button>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Section 2: Table -->
<section id="table-section" class="section dark-background">
  <div class="container" data-aos="fade-up">
    <div class="table-responsive">
      <table class="table table-hover table-striped align-middle text-center mb-0" style="border-radius: .5rem; overflow: hidden;">
        <thead class="table-dark text-white">
          <tr>
            <th>Image</th>
            <th>Article Number</th>
            <th>Article</th>
            <th>Location</th>
            <th>Unit</th>
            <th>Type</th>
            <th>Available</th>
            <th>Delete</th>
          </tr>
        </thead>
        <tbody id="selectedItemBody"></tbody> <!-- âœ… Required by JS -->
      </table>
    </div>
  </div>
</section>


<!-- Section 3: Submit -->
<section id="issue-section" class="hero section dark-background reduced-padding">
  <div class="hero-bg" data-aos="fade-in"></div>
    <div class="container" style="padding-top: -10px; padding-bottom: 40px;" data-aos="fade-up">

    <!-- Issue Type -->
    <div class="row justify-content-center mt-4">
      <div class="col-md-6">
        <h5 class="text-white">Select Issue Type:</h5>
        <div class="form-check text-white"><input class="form-check-input" type="checkbox" name="issue_type" value="broken"><label class="form-check-label">Broken / Missing Part</label></div>
        <div class="form-check text-white"><input class="form-check-input" type="checkbox" name="issue_type" value="maintenance"><label class="form-check-label">Needs Maintenance</label></div>
        <div class="form-check text-white"><input class="form-check-input" type="checkbox" name="issue_type" value="not_working"><label class="form-check-label">Not Working</label></div>
        <div class="form-check text-white"><input class="form-check-input" type="checkbox" name="issue_type" value="dirty"><label class="form-check-label">Dirty / Unusable</label></div>
        <div class="form-check text-white"><input class="form-check-input" type="checkbox" name="issue_type" value="damaged_packaging"><label class="form-check-label">Damaged Packaging</label></div>
        <div class="form-check text-white">
          <input class="form-check-input" type="checkbox" name="issue_type" value="other" onchange="document.getElementById('otherTextGroup').classList.toggle('d-none', !this.checked)">
          <label class="form-check-label">Other</label>
        </div>
        <div id="otherTextGroup" class="mt-2 d-none">
          <input type="text" id="otherText" class="form-control" placeholder="Describe the issue">
        </div>

        <!-- Upload -->
        <div class="mt-3">
          <label class="form-label text-white">Upload Photo (optional):</label>
          <input type="file" id="photo" class="d-none" onchange="updateFileLabel()">
          <div class="d-flex align-items-center gap-2">
            <button type="button" class="btn btn-outline-light btn-sm" onclick="document.getElementById('photo').click()">Choose File</button>
            <span id="fileLabel" class="text-white">No file chosen</span>
          </div>
        </div>

        <!-- Quantity Input -->
        <div class="mt-3 d-inline-block">
          <label for="count" class="form-label text-white me-2">Number to report:</label>
          <input type="number" name="count" id="count"
       class="form-control d-inline-block"
       style="width: 60px; height: 30px; padding: 2px 6px; font-size: 0.85rem;"
       min="1" value="1" required>

        </div>


      </div>
    </div>

    <!-- Submit Button -->
    <div class="row justify-content-center mt-5">
      <div class="col-xl-4 col-md-4" data-aos="fade-up" data-aos-delay="300">
        <div class="icon-box text-center py-3 text-white" style="cursor: pointer;" onclick="document.getElementById('submitBtn').click()">
          <i class="bi bi-exclamation-triangle" style="font-size: 1.5rem;"></i>
          <h3 class="mt-2" style="font-size: 1rem;">Submit Report</h3>
        </div>
        <button id="submitBtn" type="button" class="btn btn-link text-white p-0 d-none" onclick="submitReport()"></button>
      </div>
    </div>


  </div>
</section>

<!-- Scripts -->
<script src="https://unpkg.com/html5-qrcode"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="{{ url_for('report_issue.report_issue_js', filename='report_issue.js') }}"></script>
<script>
  function updateFileLabel() {
    const input = document.getElementById("photo");
    const label = document.getElementById("fileLabel");
    label.textContent = input.files.length > 0 ? input.files[0].name : "No file chosen";
  }
</script>

{% endblock %}
